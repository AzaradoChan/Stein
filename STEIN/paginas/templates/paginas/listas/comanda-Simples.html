{% extends 'paginas/modelo.html' %}

{% load static %}

{% block titulo %}
Gerenciamento de Comandas
{% endblock %}

{% block conteudo %}
<script type="text/javascript">
    function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
    async function timedRefresh(tempo) {
        await sleep(tempo);
        if ($('#checaAtualizar').val() == 'true'){
            window.location.reload();
        } else{
            timedRefresh(10000)
        }
    }

    function atenderChamado(mesaID) {
        $.ajax({
            type: "GET",
            url: "{% url 'chamar-garcom' %}",
            data: {
                mesaID: mesaID,
            },
            success: function (response) {
                $('#chamadoGarcom').attr('class', '')
                document.location.reload(true);
            }
        });
    }
</script>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="" id="checaAtualizar" checked>
    <label class="form-check-label" for="checaAtualizar">
      Selecione para Atualizar Automaticamente.
    </label>
  </div>
<div class="row mt-3 mx-auto justify-content-around">
    {% for mesa in object_list.0 %}
        {% if mesa.id in object_list.2 %}
            <button class="btn btn-warning btn-lg" style="max-width: 70px;">
                {{mesa.numero}}
            </button>
        {% elif mesa.id in object_list.1 %}
            <button class="btn btn-danger btn-lg" style="max-width: 70px;">
                {{mesa.numero}}
            </button>
        {% else %}
            <button class="btn btn-success btn-lg" style="max-width: 70px;">
                {{mesa.numero}}
            </button>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
    $(document).ready(function () {
        if ($('#checaAtualizar').is(':checked')) {
            $('#checaAtualizar').val('true');
            } else {
            $('#checaAtualizar').val('false');
            }
        $("#checaAtualizar").on('change', function() {
            if ($(this).is(':checked')) {
            $(this).val('true');
            } else {
            $(this).val('false');
            }
        });
        timedRefresh(5000);
    });
</script>
{% endblock %}